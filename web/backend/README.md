# Lane Mapping Tool - Backend

This directory contains the Flask-based backend for the Lane Mapping Tool. It handles graph operations, data persistence, and communicates with the React frontend.

## ðŸ”§ Setup

### Prerequisites

*   Python 3.8 or higher

### Installation

1.  Navigate to this directory:
    ```bash
    cd web/backend
    ```

2.  Create and activate a virtual environment (recommended):
    ```bash
    python -m venv venv
    # Windows:
    venv\Scripts\activate
    # Mac/Linux:
    source venv/bin/activate
    ```

3.  Install dependencies:
    ```bash
    pip install -r requirements.txt
    ```

## ðŸš€ Running the Server

Start the Flask application:

```bash
python app.py
```

The server will start on `http://localhost:5000`.

## ðŸ“¡ API Reference

### Data Endpoints
*   **`GET /api/data`**: Returns the current graph state (nodes, edges, loaded filenames).
*   **`GET /api/files`**: Lists available raw `.npy` files and saved graph files.
*   **`POST /api/save`**: Saves the current graph state to the `workspace/` directory and creates a backup.
*   **`POST /api/load`**: Loads specified raw files or a saved graph session.

### Operation Endpoints
*   **`POST /api/operation`**: Performs graph manipulations.
    *   **actions**: `add_node`, `add_edge`, `delete_points`, `break_links`, `reverse_path`, `remove_between`, `copy_points`, `undo`, `redo`, `update_node_properties`.
*   **`POST /api/smooth`**: Calculates and returns a smoothed path between two nodes using B-Spline interpolation.

## ðŸ“‚ Data Management

*   **Raw Data**: Stored in `../../lanes/` (relative to project root). These are immutable `.npy` files generated by the mapping vehicle.
*   **Workspace**: Stored in `workspace/`. This is where `graph_nodes0.npy` and `graph_edges0.npy` are saved.
*   **Temp Lanes**: When raw files are loaded, they are copied to `workspace/temp_lanes/` to allow for non-destructive editing (splitting/merging).

## ðŸ“‚ Structure

*   `app.py`: Main Flask application.
*   `utils/data_manager.py`: Core logic for managing the graph, undo/redo stack, and file I/O.
*   `utils/curve_utils.py`: B-Spline smoothing implementation.

